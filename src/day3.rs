/// The line only provides a basic pattern that extends infinitely to the right. Therefore,
/// the idx provided can be larger than the length of the characters in the line. The characters
/// and the index are zero indexed. In the string a tree is marked as '#'
fn is_tree(line: &str, idx: usize) -> bool {
    line.chars().collect::<Vec<char>>()[idx % line.len()] == '#'
}

struct Step {
    down: usize,
    right: usize,
}

struct Pos {
    /// The current position
    row: usize,
    col: usize,

    /// These don't change as the position changes.
    step_size: Step,
    rows: usize,
}

impl Iterator for Pos {
    type Item = (usize, usize);

    /// Everytime you ask for the next element, it checks if there are further rows of trees to traverse over.
    fn next(&mut self) -> Option<Self::Item> {
        let nxt_row = self.row + self.step_size.down;

        if nxt_row < self.rows {
            self.row = nxt_row;
            self.col += self.step_size.right;

            Some((self.row, self.col))
        } else {
            None
        }
    }
}

/// https://adventofcode.com/2020/day/3
/// how many trees would you encounter ?
fn part1(trees: &[&str], steps_to_rt: usize, steps_down: usize) -> usize {
    let mut count_trees = 0;

    let pos = Pos {
        row: 0,
        col: 0,
        step_size: Step {
            down: steps_down,
            right: steps_to_rt,
        },
        rows: trees.len(),
    };

    for (row, col) in pos {
        if is_tree(trees[row], col) {
            count_trees += 1;
        }
    }
    count_trees
}

#[cfg(test)]
mod tests {
    #[test]
    fn t1() {
        assert_eq!(super::part1(TREES, 3, 1), 7);
    }

    #[test]
    fn t2() {
        let x1 = super::part1(TREES, 1, 1);
        let x2 = super::part1(TREES, 3, 1);
        let x3 = super::part1(TREES, 5, 1);
        let x4 = super::part1(TREES, 7, 1);
        let x5 = super::part1(TREES, 1, 2);

        assert_eq!(x1, 2);
        assert_eq!(x2, 7);
        assert_eq!(x3, 3);
        assert_eq!(x4, 4);
        assert_eq!(x5, 2);

        assert_eq!(x1 * x2 * x3 * x4 * x5, 336);
    }

    #[test]
    fn part1() {
        assert_eq!(super::part1(TREES2, 3, 1), 242);
    }

    #[test]
    fn part2() {
        let x1 = super::part1(TREES2, 1, 1);
        let x2 = super::part1(TREES2, 3, 1);
        let x3 = super::part1(TREES2, 5, 1);
        let x4 = super::part1(TREES2, 7, 1);
        let x5 = super::part1(TREES2, 1, 2);

        //assert_eq!(x1, 2);
        //assert_eq!(x2, 7);
        //assert_eq!(x3, 3);
        //assert_eq!(x4, 4);
        //assert_eq!(x5, 2);

        assert_eq!(x1 * x2 * x3 * x4 * x5, 2265549792);
    }

    const TREES: &'static [&str] = &[
        "..##.......",
        "#...#...#..",
        ".#....#..#.",
        "..#.#...#.#",
        ".#...##..#.",
        "..#.##.....",
        ".#.#.#....#",
        ".#........#",
        "#.##...#...",
        "#...##....#",
        ".#..#...#.#",
    ];

    const TREES2: &'static [&str] = &[
        "...........#..#.#.###....#.....",
        "...#..#...........#.#...#......",
        "#.....#..#........#...#..##....",
        "..#...##.#.....#.............#.",
        "#.#..#......#.....#....#.......",
        ".....#......#..#....#.....#....",
        ".......#.#..............#......",
        ".....#...#..........##...#.....",
        "...#....#.#...#.#........#...#.",
        "..#.........###.......##...##..",
        ".#....#...........#........#..#",
        "..#.............##.............",
        "..#.##.#....#................#.",
        ".....##.#.......#....#...#.....",
        "......#.#....##................",
        "..#..........###..#..#.#..#....",
        "....#..............#....##..#.#",
        ".#.........#.#....#.#.#....#...",
        "..#.....#......##.#....#.......",
        "..#.#....#..#.#...##....###....",
        "...#......##...#........#.#..#.",
        ".##.#.......##....#............",
        "...##..#.#............#...#.#..",
        ".##...##.#..#..................",
        "..#......##......#......##.....",
        ".....##...#..#...#.........#...",
        ".##.#.....#..#..#.##....##....#",
        "..#.#......#.......##..........",
        "......................#......##",
        "##.#...#.................#.#.#.",
        "......#.#..........#.....##.#..",
        "#.#......#.....#...........#...",
        ".....#...#.......#..#..#.#...#.",
        "...........#......#.#...#......",
        "....##...##...........#......#.",
        ".........#.##..................",
        "......#...#....#......##.##...#",
        "......#...#.#########......#...",
        ".......#.#...#.......#..#......",
        "............#...#...#.###...##.",
        "...........#..........#...#....",
        "...#..#.#................#.#..#",
        "..#....#.....#.............#.#.",
        "....##......#........#....#....",
        "........##...............#....#",
        "........#..#...#..............#",
        "...#....#.#...#..#...#....#.#.#",
        ".........#.......#....##.......",
        "#.##..............#.#........##",
        "......................###......",
        ".........#....##..##....#.#.#..",
        ".#...##.#.#...#....##..#.....#.",
        "....................#.#......#.",
        ".#..#.......................#..",
        "..#..#.............#..#....#...",
        "...#...#..#...#...#.#..#.##....",
        "........#....#...#....#........",
        ".#.....#........#.........#...#",
        "...#......#..#..#..####..#.....",
        "#....#..............#.##.......",
        ".#....#.............##...#.....",
        "....#...#.##........##......#..",
        "##....#...#.......#..#........#",
        "....##........................#",
        "..................#..#.........",
        "..#....#........#..#.......#...",
        "#...#..#....#...##...........#.",
        ".........#..#..#.#.##..........",
        "....#.#..#.....#..#.#.#.#..#.##",
        "##................#.##.....#...",
        ".#.....###..#..#..#.....#....##",
        "...#...........#..........####.",
        ".#.....#....#......#.##..#.#...",
        "..#...##....#................#.",
        "........#.......#......#.#.....",
        "....#.#.#.#....#...#......#..#.",
        "...........#......#..#.........",
        "###...##......##.#..#....##....",
        "##....##.........#..#....###...",
        "#.#.....#....#......#...#..##..",
        "#....##.#..............#.##....",
        ".#........#.#.........#...#....",
        "......................#......#.",
        "........#..#..##.....#..#.#....",
        "..#...###.................#..#.",
        "...#...#............#..........",
        ".##.......#..#.........#....#..",
        ".#..............#....#....##...",
        "...............##..#.#.......##",
        ".#.....#....#...#..#.......#..#",
        "#..#.............#....#......#.",
        ".....#.#......#.........###..#.",
        ".#...#.#...............#....#..",
        "#......#.............#.........",
        ".#.##.#.####...#..#.##..#.....#",
        ".....#......#..#...#.......#...",
        "#........###...#.....#..#.....#",
        "....#.#.....#...#..........#...",
        "...#.#.......#.#......#..#.##..",
        "..#..........#.#..#.......#.#..",
        "#...#.#..............#...###.#.",
        "...#..#...#............###.....",
        "..#..#...#.#............#..#...",
        ".###.#.....................#..#",
        "....#....#..#.....##.##........",
        "#....#....#.#..#.........#.....",
        ".#.....##....#............##..#",
        "#....#.#...#...#..#.#......#...",
        "#.....##.....##.....##.#...##..",
        "...##...#..#..####.#........#..",
        ".........#...#......##..##..#..",
        "..#.....###.#..#..####.#.......",
        ".......#......#...#..##....#...",
        ".#.....#.#.#..#....#...#..##...",
        "..........#.#...#...#.#..#.....",
        "....#.....#........#.....##..#.",
        "..#.#.##.........#...##.....##.",
        ".........#.##....#............#",
        "............##.....#.......#.#.",
        "......#.....#...#..#..###......",
        "##.....#.......#...##.#....#...",
        "...........##......#..##...#.#.",
        "..#.#.#.#...#.......#....#...#.",
        "#.............#.....#.#...###..",
        "##....#.......#.....#..##.#....",
        "...#.......#....#.........##...",
        "......#.......#......##.##.....",
        "..#......#...#.#........#......",
        "....#.#....#.#.##......#.....#.",
        "#......#.........#..#....#.....",
        "........#..#....##.....#.......",
        "#......##....#.##....#......#..",
        "..#.......#............##.....#",
        "...........#...#...........#...",
        "#.......#...#....#....#...#.#.#",
        "..###..#........#........#.....",
        "..#..###...........#.#......#..",
        ".#...........#......#..........",
        ".#.......#.....#.......#.......",
        "..#......##.#............#....#",
        "#..........#.....#.#..#........",
        ".....#...##.##.......#......#..",
        "..........#.....#........#.#.#.",
        "....#......#.....#......#.#....",
        ".........#.#.#..#...##....#...#",
        ".........#.......#...##...#.#..",
        ".##........#...............#...",
        ".......#....#...........##.....",
        ".........###......#.........#.#",
        "......#.......#...#..........#.",
        "...#.#..........##......#...#..",
        "#.......#.#..........#.........",
        "................#..#......#..##",
        ".....#...#....#.#.....#........",
        "#.....#....#...........#....#..",
        "#....#.#..#...##....#...##.#...",
        "...#.....#......#.#....#..#..#.",
        "..#................#...#.#..##.",
        "..........#..............#..#.#",
        ".....##.....#..#.###...........",
        "....#.#......#.#...........#...",
        ".#....#.#.........##.#....#....",
        ".#.#........#........###....#..",
        "##.#................#...#..#...",
        ".......#......##..#.....#..#.#.",
        "...#............#......###...##",
        "#.#...........#.........#......",
        ".....#.#.#.................#...",
        "....#..............#...#.#.....",
        "...#.#.....##..#...............",
        ".#..##...#....##.....###..#....",
        "...............#...#...#.#.###.",
        ".###....#.....#...#.#......#...",
        "...#..#.....#.......#..##.#....",
        "...........#..#....##..#...#...",
        "...#...#..........#.......##.#.",
        "............#.#.......#........",
        "....#.........#.....#..........",
        "...#.###.##..#...##..####..#..#",
        ".#.#...#..#...................#",
        ".....#..#.....##..#............",
        "....#......#...##..#.##........",
        "...#...............#..#.....##.",
        "...#......#.........#.#..##....",
        ".#....#.##.......#......#......",
        "....#.......#....#..........#..",
        "#.#.#....###.#.#.............#.",
        "..##..###........#.#..#.#..#...",
        "......#.#............##.#...###",
        ".........#.#....#####.....##...",
        "............##......#.#..#.....",
        "...#.....#.....###....#........",
        "##..........####.##.#.#........",
        "....................##.....##.#",
        "#.#............#........#......",
        "....#...##.....#......#....#...",
        "...###.#..##..................#",
        "..###......#..............#.#.#",
        ".#...#...........#....#........",
        "....#............#..#..#.#.....",
        "...#.........#.#.........#.####",
        "..#...#...#...#...........#....",
        "...............#.#......##..#..",
        "#....#.#.......#.#..#......#..#",
        "........#.#....#..#...#..#...#.",
        "...#..#.......#...........#....",
        "...........#.......#...........",
        ".#......#................#.....",
        "....#.#.#...#......#..#...#....",
        "................#.#.#....#.....",
        ".........................##..#.",
        ".#...........#............##...",
        "#...............#.....##.#.#..#",
        ".........#.......###....#.....#",
        "....##...#...#.....#..#........",
        "........#.....#..#.#.#...#..#..",
        "......#.......#.#.........#.#..",
        "#......#............#...#....#.",
        "#..##...#..#................#..",
        ".##...#...#.....#.##.......#..#",
        ".......#.##........##..##......",
        "##.#..##...............#.....#.",
        "......#....#..##...#......###.#",
        "#........##..#....#.#......#...",
        ".#......##.#...#.#...#.........",
        ".#.#...#..#.............#......",
        ".##..........#..........#......",
        ".#.....#.....#..............#.#",
        "..#.........#..#.#.....#.#....#",
        "..#.##..............##...#..###",
        "....................#..........",
        "......###..#..#...........#....",
        "..#..........#.......#...#.....",
        "...#......#......#.............",
        "....##..............#.#.....#..",
        "........#.#......#..#........##",
        ".............#...#.#.........##",
        "...###...#..........##.......#.",
        ".#..........#...##..#.#.....#..",
        "##...#.........#...............",
        "......#....#....#.....#.....#..",
        "..........#....#...#...#..#...#",
        "...##....#.#.#..#...##.........",
        "#......#.#...##.###...#....#...",
        "##.......##.#......##..#...#...",
        "......#.............#.##.....##",
        "#.......###....####.#...##....#",
        "..#...#..#.......#..........#..",
        "#.....#..#..#..#.##...###...#..",
        ".....##.#..#..#..#.#....#...#..",
        "..#...#..................##....",
        "....#.#........##..............",
        "#...#.......##...#...#.#.......",
        "..#...#........##....#.#.......",
        "..........###...###...#......#.",
        "#.....#..###...##...##..#..#..#",
        "..#.....##.....#.......##..#.#.",
        "........#........#.........#...",
        ".................#....#.......#",
        ".......#...#.....#...#.#.......",
        "....##...............#...##...#",
        ".##...#................#...#...",
        ".............#.................",
        ".#..#....#....#.#....#.........",
        ".#.#..#..........#.......#.....",
        ".....##.....##...#..#..........",
        "#...#.#.........#......#..#....",
        "........#....#...#....#.#.##...",
        "....#..#........#...#...#......",
        ".#..#.....#.#...#.........#....",
        ".#..#..#...........#..#....#...",
        "....###.............#..#.......",
        "#......#..#..##..........#.#...",
        "#..#..#.##..#...#.#.#..........",
        "....###......#.##.....#....#...",
        ".##..#...#......##.#...........",
        "..#..#.......#.....#.##....#.#.",
        ".......#.#.#........#....##....",
        "..##...#....#...............###",
        "#..##..#...........#.#....##...",
        "...##..#.....................#.",
        "###......#....#....###..#...##.",
        ".........##............#..#...#",
        "..#..........#...#.#.#......#.#",
        ".......#.....##..##......#.##..",
        "#..........#.....##.#..........",
        "#.......#.#...#...#....#.......",
        "#...#.....##.......#.#..#.#.#..",
        ".........#.#.#..#..#...#.###...",
        ".................##...#....#...",
        "###.......#..........##...#....",
        "#.#..#.........#....##.#.......",
        "......#.#.....#........#.......",
        ".......#.#........#......#.#..#",
        "..............#..#...##....#..#",
        "#...........#...##.....#..#.#..",
        "..#....#..#.#.#...#..#....#.#..",
        "...##.#.....#..#...##..#.....#.",
        "..#.#................#........#",
        "......#...#.............#......",
        ".##............#....#...#..#...",
        "....#...#...........#.......#..",
        ".###..#.......#.............#.#",
        ".#.#....#.#...........#.#......",
        "...#.........#.........#..#....",
        "...#..........#.#.....#.#......",
        ".....#........#....##......#...",
        "..#.#.#......#..#.#......#....#",
        ".#.#..#................#.#.....",
        ".#.#.........##...#.......#.#.#",
        "#..#.....#...#..#...........#..",
        "..##......####......#..#....###",
        "#.....###....#.#........#..#..#",
        "..##.#...#.#..##..........#..#.",
        "#.........#.#.............#...#",
        "...#.#...#...#.#.#....##.......",
        "##.##...#.....#...#...........#",
        "....#........#.#.....#.........",
        ".................##..#..##...##",
        ".....##....#...#...#.....#..#..",
        "....#...#........#............#",
        "..#...........##....#...#...##.",
        ".....#......#.........#..##.#..",
    ];
}
